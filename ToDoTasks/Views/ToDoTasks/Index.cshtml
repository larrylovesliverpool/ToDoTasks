@model ToDoTasks.ViewModels.ToDoTasksViewModel

@{
    ViewBag.Title = "To Do Tasks";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script>

    $("body").on("click", "#BtnAdd .Add", function () {

        $('#InputText').removeClass('hidden');
        $('#AddNewTask').removeClass('show').addClass('hidden');
    });

    $("body").on("click", "#BtnAdd .SubmitAdd", function () {

        $('#InputText').removeClass('show').addClass('hidden');
        $('#AddNewTask').removeClass('hidden');

        var textDescription = $('#InputDescription').val();

        /* form html for added row */
        var td_Checkbox = '<td id="checkbox" class="Checkbox"><input type="checkbox" class="Tickbox" /></td>';
        var td_Description = '<td class="Description"><span data-id="">' + textDescription + '</span></td>';
        var td_DeleteBtn = '<td><button id="BtnDelete" class="Delete btn" href="javascript:;">Delete</button></td>';

        /*call to controller for adding row to db/xml file */
        $.ajax({
            type: "POST",
            url: "/ToDoTasks/AddTask",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (response) {
            }
        });

        /* add after ajax call as need returned row id from db/ajax file */

        $('<tr>' + td_Checkbox + td_Description + td_DeleteBtn + '</tr>').prependTo("table > tbody");

    });

    $("body").on("click", "#tblTasks .Delete", function () {

        if (confirm("Do you want to delete this Task?")) {
            var row = $(this).closest("tr");
            var taskId = row.find("span").attr("data-id");

            // leave one empty row in table //
            if ($("#tblTasks tr").length > 2) {
                row.remove();
            } else {
                row.find(".Delete").hide();
                row.find("span").html('&nbsp;');
            }

            $.ajax({
                type: "POST",
                url: "/ToDoTasks/DeleteTask",
                data: '{taskId: ' + taskId + '}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) { }
            });
        }
    });

    $("body").on("click", "#tblTasks .Tickbox", function () {

        //get status of checkbox and toggle strikeout//

        if (confirm("Do you want to mark this Task as completed?")) {
            var row = $(this).closest("tr");
            var taskId = row.find("span").attr("data-id");

            /* strike out description */
            var htmlContent = '<span><strike>' + row.find("span").html() + '</strike></span>';
            row.find("span").html('&nbsp;').html(htmlContent);

            /* remove checkbox */
            row.find("#checkbox").html('&nbsp;');

            $.ajax({
                type: "POST",
                url: "/ToDoTasks/CompletedTask",
                data: '{taskId: ' + taskId + '}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) { }
            });
        }
    });

</script>

<div>
    <h2>To Do Tasks</h2>
</div>

<div class="row">
    <div id="BtnAdd" class="col-lg-12 pull-right">
        <div id="AddNewTask" class="show">
            <button class="Add btn" href="javascript:;">Add a New Task</button>
        </div>
        <div id="InputText" class="hidden">
            <input id="InputDescription" type="text"/>
            <button class="SubmitAdd btn" href="javascript:;">Submit</button>
        </div>
    </div>
</div>

<br />

<table id="tblTasks" class="table" cellpadding="0" cellspacing="0">
    <thead>
        <tr>
            <th style="width:5%">Completed</th>
            <th style="width:75%">Task</th>
            <th style="width:20%"></th>
        </tr>
    </thead>
    <tbody>
    @foreach (var task in Model.ToDoTasks)
    {
        <tr>
            <td id="checkbox" class="Checkbox">
                <input type="checkbox" class="Tickbox" />
            </td>
            <td class="Description">
                <span data-id="@task.Identifier">@task.Description</span>
            </td>
            <td>
                <button id="BtnDelete" class="Delete btn" href="javascript:;">Delete</button>
            </td>
        </tr>
    }
    </tbody>
</table>


